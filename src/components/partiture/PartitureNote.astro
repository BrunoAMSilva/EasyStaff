---
import type { Measure, Note } from "../../content.config";
import { getNoteColorByStep } from "../../utils/note-colors";
import { getNoteName } from "../../utils/note-notation";

interface Props {
    note: Note;
    measure: Measure;
    beat: number;
}

const { note, measure, beat } = Astro.props;

const color = getNoteColorByStep(note.pitch?.step || "");

const stave = note.staff || 1;
const duration = note.duration || 1;
const fingering = note.notations?.technical?.fingering || null;
const row =
    note.pitch?.octave && note.pitch?.step
        ? (stave - 1) * 13 +
          6 +
          ["B", "A", "G", "F", "E", "D", "C"].indexOf(note.pitch.step) +
          1
        : 1;
const letterNote = note.pitch?.step ? getNoteName(note.pitch.step, "letter") : "";
const solfegeNote = note.pitch?.step ? getNoteName(note.pitch.step, "solfege") : "";
const octaveLabel = note.pitch?.octave ?? "";
---

<div
    style={`grid-row: ${row}; grid-column: ${beat} / span ${duration};`}
    class={`note-visual flex items-center justify-between mx-2 pl-2 rounded-lg text-white text-md font-semibold ${color}`}
>
    <span class="note-labels flex flex-col gap-0.5">
        <span class="notation-label notation-letter">{letterNote}{octaveLabel}</span>
        <span class="notation-label notation-solfege">{solfegeNote}{octaveLabel}</span>
    </span>
    {
        fingering && (
            <span class="rounded-r-lg bg-black/20 font-light text-xs h-full aspect-square text-center grid place-content-center">
                {fingering}
            </span>
        )
    }
</div>
